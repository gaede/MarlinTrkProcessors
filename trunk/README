############################################################################################################
#
#    MarlinTrkProcessors
#
#    Collection of Tracking Relelated Processors Based on MarlinTrk
#
#    S. Aplin, F. Gaede DESY, 2011
#
#
############################################################################################################

  ==== This is still Work in Progress =======


------------------------------------------------------------
 

 =============================================================================================================

  --------
 | v01-06 |
  -------- 

  General:			 Removed use of sort predicate. Use sorted list of std pairs instead.
  				 Use _maxChi2PerHit in fits. 

  FullLDCTracking_MarlinTrk:	 Corrected uninitialised covariance matrix in combine tracks method.
  				 Improved hit and geometry handling. 
				 Removed unused parameters. 
				 Fixed problem in allocating left over silicon hits, track fit was incorrect after adding a hit. 
				 Corrected point_res_rphi for FTD SpacePoints. 
				 Removed unused code.     

  TruthTracker:			 Added new mode to fit tracks iteratively, off by default. Allow the CED event display to be used during track creation.
  				 
				 For the iterative mode split Tracks now have the individual segments added to a separate collection. 
				 These segments are used to produce a combined track which uses the innermost and outermost segments to 
				 provided the track states at the IP, FirstHit, LastHit and Calo respectively. 
				 The combined track is added to the main track collection, the NDF and chi2 are set with the values from the innermost segment.
				 The NDF and chi2 values for the other segments can be retrieved from the tracks added to the composite track.  
				 
				 Hits with no MCParticle are discarded.

  SiliconTracking_MarlinTrk:	 Added protection against being overwhelmed by a very large number of hits within one sector. 
 				 The default is set to 100. For now an ERROR message is printed and SkipEventException thrown. 
				 This will be removed when the problem is more properly addressed.
				 Make sure sort predicate for chi2 fulfils strict weak ordering.
  				 Fixed problem where using return instead of continue caused loss of all fitted tracks when single track fit failed.
				 Improved hit and geometry handling. 
				 Instrumented with CEDEventDisplay to improve debugging. 
				 Removed unused parameters.

  SpacePointBuilder:		 Corrected SpacePoint creation bug. Endpoint of rear strip swapped with endpoint of front strip. Added debug output for checking whether a strip is created from a real combination or ghost combination.
 

  --------
 | v01-05 |
  -------- 

 General:			 Added dependencies on KiTrack and KiTrackMarlin to MarlinTrkProcessors.
 
 Refitting:			 Added the TrackSubsetProcessor, to get the best subset from a redundant set of tracks. 
 				 TruthTracker restructured to use new convenience methods from MarlinTrk to produce 
				 cannonical trackstates. The diagonal elements of the Initial error matrix can now be set individually.
				 Fixed r_comparison sort problem.

 SiliconTracking_MarlinTrk	 Use convenience functions for track fitting from MarlinTrk. Provide steering of initial covariance matrix,  				 
& FullLDCTracking_MarlinTrk	 and max delta chi2 for adding hits. 
  				 Removed the creation of relations for MC <-> Tracks.

 SpacePointBuilder:		 Corrected bias in position by using vertex constraint	

  --------
 | v01-04 |
  -------- 

  SimplePlanarDigiProcessor:	 When calling getLadderNumber the "ladderNumber" was given as input instead of the "layerNumber" (typo).
  				 In getLadderNumber some hits were not assigned to the right layer due to rounding errors 
				 (they got INT_MAX which caused an exception when writing it to the bit field). Introduced a (hard coded) 1 nm rounding 
				 acceptance and all hits were found to be in their layer. In the case this should fail additionally put in that 
				 the layer with the closest distance to the layer centre is returned.
  				 Fixes from M. Killenberg 
   				
  SimplePlanarTestDigiProcessor: Updated to be able to work for all planar sub detectors, VXD, SIT, SET and FTD.
  				 Will very likely supperseed SimplePlanarDigiProcessor in the next release. 

  SiliconTracking_MarlinTrk &	 Added Strip Hits for FTD. 
  FullLDCTracking_MarlinTrk:     FTD restored to track finding and fitting.
 				 

  RefitProcessor:		 Updated to deal with recent addition of Strip Hits in FTD.

  TruthTracker:			 Allow Helix parameters for fit to be take from MCParticle using UseMCParticleParametersFotInitOfFit == true. 
  				 Allow steering of values used for the initial diagonal elements of the trackfit via InitialTrackErrors.

  --------
 | v01-03 |
  -------- 

  General:			Make use of MeasurementSurface classes from GEAR, as well as new UTIL::BitSet32 and 
   				UTIL::ILDTrkHitTypeBit from ILDConf (LCIO). 			

  SiliconTracking_MarlinTrk: 	Adapted to use composite Space-points composed from strip hits. 
     			    	Added new parameter NHitsChi2 which controls the maximal number of hits for which a track 
				with n hits is aways better than one with n-1 hits.
				General Cleanup and merger from changes from CLIC CDR. 				

  FullLDCTracking_MarlinTrk:	Adapted to use composite Space-points composed from strip hits.
	
  SimplePlanarDigiProcessor:	Adapted to have option to produce strip hits.

  TruthTracker:			Flexible collection input and able to construct track including composite Space-points.

  SpacePointBuilder:		New - Builds 3D composite Space-points from strip hits.



  --------
 | v01-02 |
  -------- 

SiliconTracking_MarlinTrk &	First version which is able to reconstruct LOI data.
 FullLDCTracking_MarlinTrk:     Fixed situation where, although more that 3 hits are excepted for fitting, 
 				less than 3 actually are included in the fit, by the kalman filter.

 SimpleCylinderDigiProcessor:	New - Uses simple gaussian smearing for cylinders.

 TruthTracker:			Fixed bug in SimTrackerHitSortPredicate.

 SimpleDiscDigiProcessor:	For LOI data the z coordinate is now set to that of the disk and the tolerance for dz has been increased to 10 microns.


  --------
 | v01-01 |
  -------- 

 SiliconTracking_MarlinTrk &   Modified to use getHitsInFit from MarlinTrk to get the correct TrackState for the first and last hits. 
 FullLDCTracking_MarlinTrk:    SiliconTracking has had the work around applied for the optimization problem of compare_r as applied 
                               to FullLDCTracking. 

  --------
 | v01-00 |
  -------- 

  SimplePlanarDigiProcessor:  
  			      Creates TrackerHits from SimTrackerHits, smearing them according to the input parameters. 
 			      The plannar geometry should be either VXD, SIT or SET described using ZPlannarLayout
 			      The positions of "digitized" TrackerHits are obtained by gaussian smearing positions
 			      of SimTrackerHits perpendicular and along the ladder according to the specified point resolutions.

  SimpleDiscDigiProcessor: 
  			      Produces a TrackerHit collection from SimTrackerHit collection. Intended for use with the FTD.
			      The positions of "digitized" TrackerHits are obtained by gaussian smearing positions
			      of SimTrackerHits in (x,y) plane according to the specified point resolution. 
	
  SiliconTracking_MarlinTrk:  Processor performing stand-alone pattern recognition in the VTX, FTD and SIT.
  			      Adaption of the of the original SiliconTracking from A. Raspereza, to use MarlinTrk.

  FullLDCTracking_MarlinTrk:  Processor performing track finding procedure in the entire ILD detector by linking track segments found 
                              by the SiliconTracking module in the silicon detectors and by Clupatra in the TPC. 
			      Adaption of the of the original SiliconTracking from A. Raspereza, to use MarlinTrk.

  RefitProcessor:             Track Refitter processor for marlin. Refits an input track collection using MarlinTrk, 
                              producing a new collection of tracks. Primarily to demonstrate the use of MarlinTrk.

  TruthTracker:     	      Track creation based on MC truth. Uses Relations between TrackerHits and SimTrackerHits to produce a track 
  			      collection. It can also fit the tracks using MarlinTrk or fill the track collection with the helix parameters
                              of the MCParticle.			   
